# 微服务架构下的登录校验设计
## 2.1.鉴权思路分析
## 单体架构 vs 微服务架构
- **单体架构**  
  只需完成一次用户登录和身份校验，即可在所有业务中共享用户信息。

- **微服务架构**  
  - 每个微服务独立部署，数据不共享  
  - 问题：每个微服务都需要单独做登录校验 → **不可取**

---

## 2.1 鉴权思路分析
### 基于JWT的实现痛点
如果每个微服务都做JWT校验：
1. **安全问题**  
   - 每个微服务都需要存储JWT秘钥  
   - 秘钥扩散导致泄露风险↑  
2. **维护问题**  
   - 重复编写校验/权限代码  
   - 算法变更时需同步所有服务  

### 解决方案：网关统一校验
**优势**：
- 秘钥仅保存在：  
  ✅ 网关服务  
  ✅ 用户服务（如需生成Token）  
- 校验逻辑集中开发，避免重复  

**校验流程示意图**：  
<img src="imgs\a.png" alt="a.png">
不过，这里存在几个问题：
- 网关路由是配置的，请求转发是Gateway内部代码，我们如何在转发之前做登录校验？
- 网关校验JWT之后，如何将用户信息传递给微服务？
- 微服务之间也会相互调用，这种调用不经过网关，又该如何传递用户信息？

这些问题将在接下来几节一一解决。
## 2.2.网关过滤器
登录校验必须在请求转发到微服务之前做，否则就失去了意义。而网关的请求转发是Gateway内部代码实现的，要想在请求转发之前做登录校验，就必须了解Gateway内部工作的基本原理。
<img src="imgs\b.png" alt="b.png">
