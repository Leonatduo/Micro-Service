# 1. マイクロサービスの理解

この章では、モノリシックアーキテクチャの長所と短所を分析し、大規模なプロジェクト開発においてモノリシックアーキテクチャにどのような問題があり、マイクロサービスアーキテクチャがそれらの問題をどのように解決するかを見ていきます。

## 1.1. モノリシックアーキテクチャ

**モノリシックアーキテクチャ（monolithic structure）**：その名の通り、プロジェクト内のすべての機能モジュールは1つのプロジェクトで開発されます。プロジェクトをデプロイする際には、すべてのモジュールを一緒にコンパイルし、パッケージングする必要があります。プロジェクトのアーキテクチャ設計や開発の手法は非常にシンプルです。

プロジェクトの規模が小さい場合、このアーキテクチャは素早く学べ、デプロイや運用も非常に便利です。そのため、初期の多くの小規模なプロジェクトではこの方法が採用されてきました。

しかし、プロジェクトのビジネス規模が大きくなるにつれて、開発チームの人数も増加し、モノリシックアーキテクチャには次第に多くの問題が現れます：
- **チーム協力コストが高い**：チームの数十人が同じプロジェクトで協力して開発すると、すべてのモジュールが同じプロジェクトに含まれているため、異なるモジュールのコード間の物理的な境界が次第に曖昧になり、最終的に機能を1つのブランチに統合する際には、コンフリクトの解決に時間がかかり、泥沼にはまってしまうことになります。
- **システムのリリース効率が低い**：どのモジュールに変更があっても、システム全体を再リリースする必要があります。システムのリリース過程では、モジュール間で多くの制約があるため、ファイルを比較し、どこかに問題があるとリリースが失敗することになります。リリースに数十分、さらには数時間かかることもあります。
- **システムの可用性が低い**：モノリシックアーキテクチャでは、すべての機能モジュールが1つのサービスとしてデプロイされており、相互に影響を与え合います。特に、ホットな機能がシステムリソースを使い果たし、他のサービスが低可用性になることがあります。

## 1.2. マイクロサービス

マイクロサービスアーキテクチャでは、まずサービス化を行い、モノリシックアーキテクチャの中の機能モジュールを分割して、独立した複数のサービスとしてデプロイします。また、以下の特徴を満たす必要があります：

- **単一責任**：1つのマイクロサービスは、ビジネス機能の一部を担当し、そのコアデータは他のモジュールに依存しません。
- **チーム自治**：各マイクロサービスには独立した開発、テスト、リリース、運用のチームがあり、チームの規模は10人以下です。
- **サービス自治**：各マイクロサービスは独立してパッケージングしてデプロイされ、独自のデータベースにアクセスします。さらに、サービスの隔離を適切に行い、他のサービスに影響を与えないようにします。

例えば、ショッピングモールのプロジェクトでは、商品、ユーザー、ショッピングカート、取引などのモジュールを分割し、異なるチームに開発を任せ、それぞれ独立してデプロイすることができます。

### モノリシックアーキテクチャの問題は解決されましたか？
- **チーム協力コストが高い？**
  - サービスが分割されることで、各サービスのコード量が大幅に減少し、開発に参加するバックエンドエンジニアは1〜3名程度となり、協力コストが大幅に削減されます。
  
- **システムのリリース効率が低い？**
  - 各サービスは独立してデプロイされており、あるサービスのコードに変更があった場合、そのサービスだけをパッケージしてデプロイすることができます。

- **システムの可用性が低い？**
  - 各サービスは独立してデプロイされ、サービスの隔離が適切に行われ、各サービスは独自のサーバーリソースを使用するため、他のサービスに影響を与えることはありません。

このように、マイクロサービスアーキテクチャはモノリシックアーキテクチャの問題を解決し、特に大規模なインターネットプロジェクトに非常に適しているため、各大手インターネット企業で広く採用されています。以前、分散アーキテクチャという言葉を聞いたことがあるかもしれませんが、分散アーキテクチャはサービスの分割プロセスであり、実際にはマイクロサービスアーキテクチャは分散アーキテクチャのベストプラクティスの一つです。

## 1.3. マイクロサービスが直面する課題

もちろん、マイクロサービスアーキテクチャはモノリシックアーキテクチャのさまざまな問題を解決できますが、分割の過程で他にも多くの問題に直面することになります。例えば：
- サービス間でのビジネス処理が発生した場合、どのように対処するか？
- ページリクエストはどのサービスにアクセスすべきか？
- どのようにして各サービス間でのサービス隔離を実現するか？
