# 1. ゲートウェイルーティング

## 1.1. ゲートウェイの基礎

### ゲートウェイとは？
ゲートウェイはネットワークの「関所」のような存在です。異なるネットワーク間でデータを転送する際に、ルーティングや転送、セキュリティチェックを行います

身近な例えると、ゲートウェイは「社宅の守衛さん」のような役割です：
- 外部からの訪問者は守衛のチェックを受ける（不正なアクセスは遮断）
- 伝言や手紙は守衛を経由して届けられる

マイクロサービスにおけるゲートウェイも同様の機能を提供します：
- セキュリティ認証（ログイン確認）
- 適切なマイクロサービスへのリクエスト転送

SpringCloud で利用可能なゲートウェイ実装：
- `Netflix Zuul`：旧式（現在は非推奨）
- `SpringCloudGateway`：WebFlux ベース、リアクティブプログラミング対応、高スループット

## 1.2. クイックスタート

### 1.2.1. プロジェクト作成
`hm-gateway` モジュールを作成

### 1.2.2. 依存関係追加
`pom.xml` に以下を追加：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>hmall</artifactId>
        <groupId>com.heima</groupId>
        <version>1.0.0</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>hm-gateway</artifactId>

    <properties>
        <maven.compiler.source>11</maven.compiler.source>
        <maven.compiler.target>11</maven.compiler.target>
    </properties>
    <dependencies>
        <!-- 共通ライブラリ -->
        <dependency>
            <groupId>com.heima</groupId>
            <artifactId>hm-common</artifactId>
            <version>1.0.0</version>
        </dependency>
        <!-- ゲートウェイ -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-gateway</artifactId>
        </dependency>
        <!-- Nacosサービスディスカバリ -->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        </dependency>
        <!-- ロードバランサー -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-loadbalancer</artifactId>
        </dependency>
    </dependencies>
    <build>
        <finalName>${project.artifactId}</finalName>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>
</project>
```
# 1.2.3. 起動クラス
`com.hmall.gateway` パッケージに作成

# 1.2.4. ルーティング設定
`application.yaml` の設定例：

```yaml
server:
  port: 8080
spring:
  application:
    name: gateway
  cloud:
    nacos:
      server-addr: 192.168.150.101:8848
    gateway:
      routes:
        - id: item
          uri: lb://item-service
          predicates:
            - Path=/items/**,/search/**
        - id: cart
          uri: lb://cart-service
          predicates:
            - Path=/carts/**
        - id: user
          uri: lb://user-service
          predicates:
            - Path=/users/**,/addresses/**
        - id: trade
          uri: lb://trade-service
          predicates:
            - Path=/orders/**
        - id: pay
          uri: lb://pay-service
          predicates:
            - Path=/pay-orders/**
```
## 1.2.5. テスト手順

1. **GatewayApplicationの起動**:
   ```bash
   ./mvnw spring-boot:run -pl hm-gateway
